'use strict';
<<<<<<< HEAD
=======
var IS_PURE = require('../internals/is-pure');
>>>>>>> fdb7c92a283e1067c995a5190717b93d6197f83d
var $ = require('../internals/export');
var global = require('../internals/global');
var call = require('../internals/function-call');
var anObject = require('../internals/an-object');
var aCallable = require('../internals/a-callable');

var TypeError = global.TypeError;

// `Set.prototype.update` method
// https://github.com/tc39/proposal-collection-methods
<<<<<<< HEAD
$({ target: 'Map', proto: true, real: true, forced: true }, {
=======
$({ target: 'Map', proto: true, real: true, forced: IS_PURE }, {
>>>>>>> fdb7c92a283e1067c995a5190717b93d6197f83d
  update: function update(key, callback /* , thunk */) {
    var map = anObject(this);
    var get = aCallable(map.get);
    var has = aCallable(map.has);
    var set = aCallable(map.set);
    var length = arguments.length;
    aCallable(callback);
    var isPresentInMap = call(has, map, key);
    if (!isPresentInMap && length < 3) {
      throw TypeError('Updating absent value');
    }
    var value = isPresentInMap ? call(get, map, key) : aCallable(length > 2 ? arguments[2] : undefined)(key, map);
    call(set, map, key, callback(value, key, map));
    return map;
  }
});
